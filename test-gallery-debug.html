<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Debug Test</title>
</head>
<body>
    <h1>Gallery Debug Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        async function testGallery() {
            // Test 1: Load albums list
            results.innerHTML += '<h2>Test 1: Loading albums list...</h2>';
            try {
                const albumsResponse = await fetch('https://kaiukodukant.ee/api/gallery/albums.json');
                const albumsData = await albumsResponse.json();
                results.innerHTML += `<p>✓ Albums loaded: ${albumsData.albums ? albumsData.albums.length : 0} albums</p>`;

                if (albumsData.albums && albumsData.albums.length > 0) {
                    const firstAlbum = albumsData.albums[0];
                    results.innerHTML += `<p>First album: ${firstAlbum.name} (ID: ${firstAlbum.id})</p>`;
                    results.innerHTML += `<p>Cover photo: ${firstAlbum.coverPhoto}</p>`;

                    // Test 2: Load specific album
                    results.innerHTML += '<h2>Test 2: Loading album photos...</h2>';
                    const albumResponse = await fetch(`https://kaiukodukant.ee/api/gallery/albums/${firstAlbum.id}.json`);
                    const albumData = await albumResponse.json();
                    results.innerHTML += `<p>✓ Album loaded: ${albumData.photos ? albumData.photos.length : 0} photos</p>`;

                    if (albumData.photos && albumData.photos.length > 0) {
                        const firstPhoto = albumData.photos[0];
                        results.innerHTML += `<p>First photo: ${firstPhoto.name}</p>`;
                        results.innerHTML += `<p>Thumbnail URL: ${firstPhoto.thumbnailUrl}</p>`;

                        // Test 3: Load thumbnail image
                        results.innerHTML += '<h2>Test 3: Loading thumbnail image...</h2>';
                        const img = new Image();
                        img.onload = () => {
                            results.innerHTML += `<p>✓ Thumbnail loaded successfully (${img.width}x${img.height})</p>`;
                            results.innerHTML += `<img src="${firstPhoto.thumbnailUrl}" style="max-width: 200px;">`;
                        };
                        img.onerror = (e) => {
                            results.innerHTML += `<p style="color: red;">✗ Failed to load thumbnail: ${firstPhoto.thumbnailUrl}</p>`;
                        };
                        img.src = firstPhoto.thumbnailUrl;

                        // Test 4: Check if placeholder URL causes issues
                        results.innerHTML += '<h2>Test 4: Checking for placeholder issues...</h2>';
                        if (firstPhoto.thumbnailUrl.includes('/api/placeholder/')) {
                            results.innerHTML += `<p style="color: red;">✗ Photo is using placeholder URL instead of S3 URL</p>`;
                        } else {
                            results.innerHTML += `<p>✓ Photo is using S3 URL</p>`;
                        }
                    }
                }
            } catch (error) {
                results.innerHTML += `<p style="color: red;">✗ Error: ${error.message}</p>`;
            }
        }

        testGallery();
    </script>
</body>
</html>